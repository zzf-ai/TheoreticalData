

# **网络层**概述

主要任务：把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。

传输单位：数据报

功能：

1. 路由选择与分组转发，一般会选择一个最佳路径

2. 异构网络互联，通过路由器将不同的网络互联形成更大的网络

   ![image-20201202210305026](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202210305026.png)

3. 拥塞控制：若所有结点都来不及接受分组，而要丢弃大量分组，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞。

   

   

   

# **数据交换方式**

![image-20201202210949508](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202210949508.png)

## 电路交换

例子：电话网络

电路交换的阶段：

建立连接（呼叫/电路建立）=>通信=>释放连接（拆除电路）

特点：独占资源

优点：

1、通信时延小

2、有序传输

3、没有冲突

4、实时性强

缺点：

1、建立连接时间长

2、线路独占，使用效率低

3、灵活性差

4、无差错控制能力



## 报文交换

报文：源主机发送的信息整体

![image-20201202212817916](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202212817916.png)

优点：

1、无需建立连接

2、存储转发，动态分配线路

3、线路可靠性较高

4、线路利用率较高

5、多目标服务

缺点：

1、有存储转发时延

2、报文大小不定，需要网络节点有较大缓存空间



## 分组交换

分组：把大的数据块分割成小的数据块

优点：

1、无需建立连接

2、存储转发，动态发分配线路

3、线路可靠性较高

4、线路利用率较高

4、相对于报文交换，存储管理更容易

缺点：

1、有存储转发时延

2、需要传输额外的信息量

3、乱序到目的主机时，要对分组排序重组

![image-20201202214635666](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202214635666.png)

## 三种方式总结

![image-20201202215143405](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202215143405.png)

1、报文交换和分组交换都采用存储转发

2、传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换传输时延最小

3、从信道利用率看，报文交换和分组交换优于电路交换，其中分组交换时延更小



# 数据报与虚电路

## 数据报方式为网络层提供无连接服务

无连接服务：不事先为分组的传输确定传输路径，每个分组独立确定传输路径，不同分组传输路径可能不同

每个分组携带源地址和目的地址

路由器根据分组的目的地址转发分组：基于路由协议/算法构建转发表=>检索转发表=>每个分组独立选路

最基本的转发表实例

![image-20201202220533945](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202220533945.png)



## 虚电路方式为网络层提供连接服务

虚电路：一条源主机到目的主机类似于电路的路径（逻辑连接），路径上所有结点都要维持这条虚电路的建立，都维持一张虚电路表，每一项记录了一个打开的虚电路的信息

通信过程：

建立连接（虚电路建立）=>数据传输=>释放连接（虚电路释放）

源主机发送”释放请求“ 分组以拆除虚电路

每个分组携带虚电路号，而非目的地址

源主机发送”呼叫请求“分组并收到”呼叫应答“分组后才算建立连接



连接服务：首先为分组的传输确定传输路径（建立连接），然后沿该路径（连接）传输系列分组，系列分组传输路径相同，传输结束后拆除连接

## 两种方式总结

![image-20201202222109704](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202222109704.png)

# 路由算法

静态路由算法（非自适应路由算法）管理员手工配置路由信息

优点：简便、可靠，在负荷稳定、拓扑变化不大的网络中运行效果很好，广泛用于高度安全性的军事网络和较小的商业网络

缺点：路由更新慢，不适用大型网络

动态路由算法（自适应路由算法）路由器间彼此交换信息，按照路由算法优化出路由表项

优点：路由更新快，适用大型网络，及时响应链路费用或网络拓扑变化。

缺点：算法复杂，增加网络负担

![image-20201202223138258](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202223138258.png)

分层次的路由选择协议

为什么要分层次

1、因特网规模很大

2、许多单位不想让外界知道自己的路由选择协议，但还想连入因特网。

自治系统AS：在单一的技术管理下的一组路由器，这些路由器用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由协议来确定在AS之间的路由

一个AS内的所有网络都属于一个行政单位来管辖，一个自治系统的所有路由器在本自治系统内都必须连通

![image-20201202223900386](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202223900386.png)

![image-20201202223915020](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202223915020.png)

# IP数据报格式

![image-20201202224116791](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202224116791.png)

![image-20201202224635422](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202224635422.png)

版本：IPv4/IPv6，4位

首部长度：单位是4B，最小为5

区分服务：指示期望获得哪种类型的服务

总长度：首部+数据，单位是1B

标识：同一数据报的分片使用同一标识

标志：共3位，只有2位有意义

![image-20201202231656159](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202231656159.png)

片偏移：指出较长分组分片后，某片在原分组中的相对位置，以8B为单位，除了最后一个分片，每个分片长度一定是8B的整数倍

生存时间：IP分组的保质期。经过一个路由器-1，变成0则丢弃

协议：数据部分的协议，主要记住TCP，6位，UDP，17位

首部检验和：只检验首部

源IP地址和目的IP地址：32位

可选字段：0-40B，用来支持排错、测量以及安全等措施

填充：全0，把首部补成4B的整数倍

# IP地址分类

![image-20201202232759474](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202232759474.png)

![image-20201202234445716](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202234445716.png)

特殊IP地址

![image-20201202233133710](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202233133710.png)

私有IP地址

![image-20201202234144159](C:\Users\招志锋\AppData\Roaming\Typora\typora-user-images\image-20201202234144159.png)